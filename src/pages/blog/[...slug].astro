---
import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

function formatDate(date: Date) {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---
<Base title={entry.data.title} description={entry.data.description ?? undefined}>
  <article class="max-w-2xl">
    <header class="post-header mb-8">
      <a href="/" class="mb-4 inline-block text-sm text-[var(--color-accent)] hover:underline">
        ‚Üê Back to posts
      </a>
      <div class="post-header-inner">
        {entry.data.image && (
          <div
            class="post-header-image"
            style={`aspect-ratio: ${entry.data.image.width} / ${entry.data.image.height};`}
          >
            <Image
              src={entry.data.image}
              alt={entry.data.title}
              width={entry.data.image.width}
              height={entry.data.image.height}
              class="h-full w-full object-contain"
            />
          </div>
        )}
        <div class="post-header-text">
          <p class="text-sm text-[var(--color-muted)]">{formatDate(entry.data.pubDate)}</p>
          <h1 class="mt-1 text-3xl font-bold text-[var(--color-text)]">{entry.data.title}</h1>
          {entry.data.description && (
            <p class="mt-2 text-[var(--color-muted)]">{entry.data.description}</p>
          )}
        </div>
      </div>
    </header>
    <div class="post-content prose prose-neutral dark:prose-invert max-w-none">
      <Content />
    </div>
  </article>
</Base>
